version: '3.8'

services:
  # ------------------------------------
  # Frontend: React (Production Mode)
  # ------------------------------------
  client:
    build:
      context: ./client
      dockerfile: Dockerfile
      # üëá ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: React ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏ï‡∏≠‡∏ô Build Image ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤ Backend ‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏´‡∏ô
      args:
        - VITE_API_PATH=${VITE_API_PATH} 
    container_name: udp-client
    restart: always
    ports:
      - "3091:80"  # ‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô IP:3091 ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏´‡πâ Nginx ‡∏´‡∏•‡∏±‡∏Å Proxy ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤
    environment:
      - TZ=Asia/Bangkok
    networks:
      - shared-network

  # ------------------------------------
  # Backend: Node.js (Production Mode)
  # ------------------------------------
  server:
    build:
      context: ./server
      dockerfile: Dockerfile      # ‚úÖ ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Prod (‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ node server.js)
    container_name: udp-server
    restart: always
    ports:
      - "3092:3092"
    environment:
      - PORT=3092
      - NODE_ENV=production
      - TZ=Asia/Bangkok
      # üëá Database Config (‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å Portainer)
      - DB_HOST=db-mysql          # ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ä‡∏∑‡πà‡∏≠ Container DB ‡πÉ‡∏ô Stack ‡∏´‡∏•‡∏±‡∏Å
      - DB_PORT=3306
      - DB_USER=root
      - DB_PASS=${DB_ROOT_PASSWORD} # ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ Password ‡∏à‡∏≤‡∏Å Env
      - DB_NAME=${DB_NAME}        # ‡∏ä‡∏∑‡πà‡∏≠ Database ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ
    # ‚ùå ‡∏•‡∏ö env_file ‡∏ó‡∏¥‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏ä‡πâ environment ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÅ‡∏ó‡∏ô
    networks:
      - shared-network

networks:
  shared-network:
    external: true